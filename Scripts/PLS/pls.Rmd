---
title: "pls"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

## sPLS
### lung cancer
#### Calibration
```{r sPLS calibration on lung, echo=FALSE, eval = FALSE, out.width='1000'}

# load data
lung.1 <- readRDS("../Results/denoised/lung.1_denoised.rds")
lung.2 <- readRDS("../Results/denoised/lung.2_denoised.rds")

# create balanced data and do calibration
foo <- function(i, datt){
  set.seed(i)
  random_control <- datt[which(datt$case_status == 0), ]
  random_control <- random_control[sample(nrow(datt), 1200), ]
  random <- rbind(random_control, datt[which(datt$case_status == 1),])
  
  ## calibration
  X_pooled <- random[,-1]
  Y_pooled <- random[,1]
  set.seed(1)
  splsda = CalibratesPLSDA(dataX = X_pooled, dataY = Y_pooled, ncomp = 1, Nrepeat = 5)
  return(splsda$NVar)
}

no_lung.1 <- sapply(1:100, lung.1, FUN = foo)
no_lung.2 <- sapply(1:100, lung.2, FUN = foo)

```

<br/>
<br/>

```{r stability analyses on lung.1, echo=FALSE, fig.cap="Stability analyses for sPLS on lung adjusted for age, sex and BMI", out.width = '1000'}
knitr::include_graphics("/rds/general/project/hda_students_data/live/Group3/TDS_Group3/PLS_plots/stab_lung_1.pdf")

```

<br/>
<br/>

```{r stability analyses on lung.2, echo=FALSE, fig.cap="Stability analyses for sPLS on lung adjusted for age, sex, BMI and smoking", out.width = '1000'}
knitr::include_graphics("/rds/general/project/hda_students_data/live/Group3/TDS_Group3/PLS_plots/stab_lung_2.pdf")
```

<br/>
<br/>

#### Stability selection
```{r stability selection on lung.1, echo=FALSE, fig.cap="Stability selection for sPLS on lung adjusted for age, sex, and BMI", out.width = '1000'}
knitr::include_graphics("/rds/general/project/hda_students_data/live/Group3/TDS_Group3/PLS_plots/CalibrationPlot_lung.1.png")
```

<br/>
<br/>

```{r selection proportion on lung.1, echo=FALSE, fig.cap="Selection proportion for sPLS on lung adjusted for age, sex, and BMI", out.width = '1000'}
knitr::include_graphics("/rds/general/project/hda_students_data/live/Group3/TDS_Group3/PLS_plots/selection_proportions_lung.1.png")
```

<br/>
<br/>

Use results from stability selection for sPLS, lambda = 36
```{r loading coefficients in lung.1, echo=FALSE, fig.cap="Loading coefficients from sPLS on lung adjusted for age, sex, and BMI", out.width = '800'}
knitr::include_graphics("/rds/general/project/hda_students_data/live/Group3/TDS_Group3/PLS_plots/sPLS_loading_lung_1.png")
```


### bladder cancer
#### Calibration
```{r sPLS calibration on bladder, echo=FALSE, eval = FALSE, out.width='1000'}
# load data
bladder.1 <- readRDS("../Results/denoised/bladder.1_denoised.rds")
bladder.2 <- readRDS("../Results/denoised/bladder.2_denoised.rds")

# create balanced data and do calibration
foo <- function(i, datt){
  set.seed(i)
  random_control <- datt[which(datt$case_status == 0), ]
  random_control <- random_control[sample(nrow(datt), 1200), ]
  random <- rbind(random_control, datt[which(datt$case_status == 1),])
  
  ## calibration
  X_pooled <- random[,-1]
  Y_pooled <- random[,1]
  set.seed(1)
  splsda = CalibratesPLSDA(dataX = X_pooled, dataY = Y_pooled, ncomp = 1, Nrepeat = 5)
  return(splsda$NVar)
}

no_bladder.1 <- sapply(1:100, bladder.1, FUN = foo)
no_bladder.2 <- sapply(1:100, bladder.2, FUN = foo)

# sPLS
x_bladder.1 <- bladder.1[,-1]
y_bladder.1 <- bladder.1[,1]
MysPLSDA_bladder.1 <- splsda(x_bladder.1, y_bladder.1, ncomp = 1, keepX = 28)

# stability analyses
set.seed(1)
Stab_bladder.1 = StabilityPlot(X = x_bladder.1, Y =  y_bladder.1, NIter = 100)
pheatmap(Stab_bladder.1, cluster_rows = FALSE, cluster_cols = FALSE, display_numbers = TRUE,
         height = 30, width = 60, fontsize = 20, filename = "stab_bladder_1.pdf")

Stab_bladder.2 = StabilityPlot(X = x_bladder.2, Y =  y_bladder.2, NIter = 100)
pheatmap(Stab_bladder.2, cluster_rows = FALSE, cluster_cols = FALSE, display_numbers = TRUE,
         height = 30, width = 60, fontsize = 20, filename = "stab_bladder_2.pdf")

```

<br/>
<br/>

```{r stability analyses on bladder.1, echo=FALSE, fig.cap="Stability analyses for sPLS on bladdern adjusted for age, sex and BMI", out.width = '1000'}
knitr::include_graphics("/rds/general/project/hda_students_data/live/Group3/TDS_Group3/PLS_plots/stab_bladder_1.pdf")

```

<br/>
<br/>

```{r stability analyses on bladder.2, echo=FALSE, fig.cap="Stability analysis for sPLS on bladder adjusted for age, sex, BMI and smoking", out.width = '1000'}
knitr::include_graphics("/rds/general/project/hda_students_data/live/Group3/TDS_Group3/PLS_plots/stab_bladder_2.pdf")
```

<br/>
<br/>

#### Stability selection
```{r stability selection on bladder.1, echo=FALSE, fig.cap="Stability selection for sPLS on bladder adjusted for age, sex, and BMI", out.width = '1000'}
knitr::include_graphics("/rds/general/project/hda_students_data/live/Group3/TDS_Group3/PLS_plots/CalibrationPlot_bladder.1.png")
```

<br/>
<br/>

```{r selection proportion on bladder.1, echo=FALSE, fig.cap="Selection proportion for sPLS on bladder adjusted for age, sex, and BMI", out.width = '1000'}
knitr::include_graphics("/rds/general/project/hda_students_data/live/Group3/TDS_Group3/PLS_plots/selection_proportions_bladder.1.png")
```

<br/>
<br/>

Use results from stability selection for sPLS, lambda = 22
```{r loading coefficients in bladder.1, echo=FALSE, fig.cap="Loading coefficients from sPLS on bladdern adjusted for age, sex, and BMI", out.width = '800'}
knitr::include_graphics("/rds/general/project/hda_students_data/live/Group3/TDS_Group3/PLS_plots/sPLS_loading_bladder_1.png")
```

<br/>
<br/>

```{r stability selection on bladder.2, echo=FALSE, fig.cap="Stability selection for sPLS on bladder adjusted for age, sex, BMI and smoking", out.width = '1000'}
knitr::include_graphics("/rds/general/project/hda_students_data/live/Group3/TDS_Group3/PLS_plots/CalibrationPlot_bladder.2.png")
```

<br/>
<br/>

```{r selection proportion on bladder.2, echo=FALSE, fig.cap="Selection proportion for sPLS on bladdern adjusted for age, sex, BMI and smoking", out.width = '1000'}
knitr::include_graphics("/rds/general/project/hda_students_data/live/Group3/TDS_Group3/PLS_plots/selection_proportions_bladder.2.png")
```

<br/>
<br/>

Use results from stability selection for sPLS, lambda = 26
```{r loading coefficients in bladder.2, echo=FALSE, fig.cap="Loading coefficients from sPLS on bladdern adjusted for age, sex, BMI and smoking", out.width = '800'}
knitr::include_graphics("/rds/general/project/hda_students_data/live/Group3/TDS_Group3/PLS_plots/sPLS_loading_bladder_2.png")
```

